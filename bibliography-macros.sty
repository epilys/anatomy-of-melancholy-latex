\RequirePackage{hyperref}
\RequirePackage[
  style=numeric,
  backref=true,
  datecirca=true,
  dateuncertain=true,
  dateabbrev=false,
  sorting=none,
  datezeros=false,% pad date components with zeros?
  dateera=secular,
]{biblatex}

\DefineBibliographyStrings{english}{%
  backrefpage = {page},% originally "cited on page"
  backrefpages = {pages},% originally "cited on pages"
}

\renewcommand*{\datecircadelim}{~}
\DeclareFieldFormat{italics}{\textit{#1}}
\DeclareFieldFormat{annote}{\notefont\tiny#1\par}
\DeclareFieldFormat{url}{{\textsc{SOURCE URL}\addcolon\space\url{#1}}}
\DeclareFieldFormat{onlineidentifier}{\nobreak{\textsc{IDENTIFIER}\addcolon\space\texttt{#1}}}
\DeclareFieldFormat{includeart}{\includegraphics[keepaspectratio,width=0.85\textwidth]{#1}}
\DeclareFieldFormat{includeartthumb}{{\graphicspath{{./figures/thumbs/}}\includegraphics[keepaspectratio,width=0.85\textwidth]{#1}}}

\DeclareBibliographyDriver{misc}{%
  \setlength{\fboxrule}{0pt}
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \fbox{\begin{minipage}{.1\textwidth}
    {%
      {%
        \iffieldundef{file}{non}{%
          \printfield[includeartthumb]{file}%
          {\scriptsize{}\\\usebibmacro{pageref}}%
          }%
          }%
          }
  \end{minipage}%
  }%
  \fbox{\begin{minipage}{0.75\textwidth}
    {\small{}%
    \begin{spacing}{0.95}%
      \usebibmacro{author}%
      \setunit{\addcomma\space}\newblock
      \printfield[italics]{title}%
      \newunit\newblock
      \setunit*{\addcomma\space}%
      \printfield{type}%
      \newunit\newblock
      \setunit*{\addcomma\space}%
      \printdate%
    \end{spacing}%
    \newunit
    \setunit*{}
    \vspace{0.4\baselineskip}
    {\scriptsize{}%
    \begin{spacing}{1}%
      {\iffieldundef{note}{}{\printfield[onlineidentifier]{note}\\*}}%
      \usebibmacro{url}%
    \end{spacing}%
    }%
    }
  \end{minipage}%
  }%
  }

\DeclareCiteCommand{\citeyearuncertain}
  {\boolfalse{citetracker}%
   \boolfalse{pagetracker}%
   \usebibmacro{prenote}}
  {\iffieldundef{year}{undefined}{\printdate}}
  {\multicitedelim}
  {\usebibmacro{postnote}}

\DeclareCiteCommand{\citeannotation}
  {\boolfalse{citetracker}%
   \boolfalse{pagetracker}%
   \usebibmacro{prenote}}
  %{\iffieldundef{annotation}{}{\justify\vspace{-1.6\baselineskip}\begin{multicols}{2}\printfield[annote]{annotation}\end{multicols}}}
  {\iffieldundef{annotation}{}{\vspace{-1.2\baselineskip}%
  \begin{multicols}{2}%
  \printfield[annote]{annotation}%
  \end{multicols}}}
  {\multicitedelim}
  {\usebibmacro{postnote}}
%\DeclareCiteCommand{\shortciteannotation}
%  {\boolfalse{citetracker}%
%   \boolfalse{pagetracker}%
%   \usebibmacro{prenote}}
%  {\iffieldundef{annotation}{}{, \printtext{\truncate{0.2\textwidth}{\printfield[annote]{annotation}}}}}
%  {\multicitedelim}
%  {\usebibmacro{postnote}}
\DeclareCiteCommand{\citetitleit}
  {\boolfalse{citetracker}%
   \boolfalse{pagetracker}%
   \usebibmacro{prenote}}
  {\printfield[italics]{title}}
  {\multicitedelim}
  {\usebibmacro{postnote}}

\newcommand{\citeart}[1]{\protect\citeauthor{#1}, \protect\citetitleit{#1}, \protect\citeyearuncertain{#1}, \protect\citefield{#1}{type}.\protect\nocite{#1}}
\newcommand{\captionart}[1]{\caption{\citeart{#1}}%
  \endgroup%
\protect\citeannotation{#1}}
%\newcommand{\citecaption}[1]{\citetitleit{#1}, \citeauthor{#1} \citeyearuncertain{#1} \nocite{#1}}
